<app-navbar></app-navbar>
<div class="main-container">
  <app-sidebar></app-sidebar>

  <div class="container-fluid py-4 animate__animated animate__fadeIn">
    <!-- Header responsive -->
    <div class="header-container">
      <h1 class="page-title">Gestión de Eventos</h1>
      <button class="btn btn-primary new-event-btn" (click)="openModal('create')">
        <i class="fas fa-plus me-2"></i>Nuevo Evento
      </button>
    </div>

    <!-- Panel de filtros responsive -->
    <div class="filters-container">
      <div class="search-filter">
        <i class="fas fa-search"></i>
        <input type="text" 
               [(ngModel)]="searchTerm" 
               (input)="applyFilters()"
               placeholder="Buscar eventos...">
      </div>
      
      <div class="filter-selectors">
        <select [(ngModel)]="selectedStatus" (change)="applyFilters()">
          <option value="all">Todos los estados</option>
          <option *ngFor="let status of statusOptions" [value]="status.value">
            {{status.label}}
          </option>
        </select>
        
        <select [(ngModel)]="selectedCategory" (change)="applyFilters()">
          <option value="all">Todas las categorías</option>
          <option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}</option>
        </select>
      </div>
    </div>

    <!-- Listado de eventos responsive -->
    <div class="events-grid">
      <div class="event-card" *ngFor="let event of filteredEvents">
        <div class="card-header">
          <h5 class="event-title">{{event.title}}</h5>
          <span class="event-status" [ngClass]="'status-' + event.status">
            <i [class]="getStatusIcon(event.status)"></i>
            {{getStatusLabel(event.status)}}
          </span>
        </div>
        
        <div class="card-body">
          <p class="event-description">{{event.description}}</p>
          
          <div class="event-details">
            <div class="detail-item">
              <i class="far fa-calendar-alt"></i>
              <span>{{event.date | date:'mediumDate'}}</span>
            </div>
            
            <div class="detail-item">
              <i class="fas fa-map-marker-alt"></i>
              <span>{{event.location}}</span>
            </div>
            
            <div class="detail-item">
              <i class="fas fa-users"></i>
              <span>{{event.attendees || 0}} asistentes</span>
            </div>
            
            <div class="detail-item" *ngIf="event.category">
              <i class="fas fa-tag"></i>
              <span>{{getCategoryName(event.category)}}</span>
            </div>
          </div>
        </div>
        
        <div class="card-actions">
          <button class="btn-action edit" (click)="openModal('edit', event)">
            <i class="far fa-edit"></i>
            <span>Editar</span>
          </button>
          <button class="btn-action delete" (click)="confirmDelete(event.id)">
            <i class="far fa-trash-alt"></i>
            <span>Eliminar</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Mensaje cuando no hay eventos -->
    <div class="empty-state" *ngIf="filteredEvents.length === 0">
      <i class="far fa-calendar-times"></i>
      <h4>No se encontraron eventos</h4>
      <p>No hay eventos que coincidan con tus criterios de búsqueda</p>
      <button class="btn btn-primary" (click)="openModal('create')">
        <i class="fas fa-plus me-2"></i>Crear nuevo evento
      </button>
    </div>

  <!-- Modal mejorado -->
  <div class="modal fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            <i [class]="editingEvent ? 'far fa-edit me-2' : 'fas fa-plus me-2'"></i>
            {{editingEvent ? 'Editar Evento' : 'Nuevo Evento'}}
          </h5>
          <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form #eventForm="ngForm" (ngSubmit)="saveEvent()">
            <div class="row g-3">
              <div class="col-md-8">
                <div class="mb-3">
                  <label class="form-label">Título del evento <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" 
                         [(ngModel)]="currentEvent.title" 
                         name="title" 
                         required
                         [class.is-invalid]="eventForm.submitted && !currentEvent.title">
                  <div class="invalid-feedback">Por favor ingresa un título para el evento</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Categoría</label>
                  <select class="form-select" [(ngModel)]="currentEvent.category" name="category">
                    <option [ngValue]="null">Sin categoría</option>
                    <option *ngFor="let cat of categories" [value]="cat.id">{{cat.name}}</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Descripción</label>
              <textarea class="form-control" 
                        [(ngModel)]="currentEvent.description" 
                        name="description" 
                        rows="3"
                        placeholder="Describe el evento..."></textarea>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Fecha <span class="text-danger">*</span></label>
                  <input type="date" class="form-control" 
                         [(ngModel)]="currentEvent.date" 
                         name="date" 
                         required
                         [class.is-invalid]="eventForm.submitted && !currentEvent.date">
                  <div class="invalid-feedback">Selecciona una fecha válida</div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Hora</label>
                  <input type="time" class="form-control" [(ngModel)]="currentEvent.time" name="time">
                </div>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-md-8">
                <div class="mb-3">
                  <label class="form-label">Ubicación <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" 
                         [(ngModel)]="currentEvent.location" 
                         name="location" 
                         required
                         [class.is-invalid]="eventForm.submitted && !currentEvent.location">
                  <div class="invalid-feedback">Ingresa una ubicación válida</div>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label class="form-label">Asistentes esperados</label>
                  <input type="number" class="form-control" [(ngModel)]="currentEvent.attendees" name="attendees" min="0">
                </div>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Estado <span class="text-danger">*</span></label>
                  <select class="form-select" 
                          [(ngModel)]="currentEvent.status" 
                          name="status" 
                          required
                          [class.is-invalid]="eventForm.submitted && !currentEvent.status">
                    <option *ngFor="let status of statusOptions" [value]="status.value">
                      {{status.label}}
                    </option>
                  </select>
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label class="form-label">Prioridad</label>
                  <select class="form-select" [(ngModel)]="currentEvent.priority" name="priority">
                    <option value="low">Baja</option>
                    <option value="medium">Media</option>
                    <option value="high">Alta</option>
                  </select>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">
            <i class="fas fa-times me-1"></i> Cancelar
          </button>
          <button type="button" class="btn btn-primary" (click)="eventForm.ngSubmit.emit()">
            <i [class]="editingEvent ? 'fas fa-save me-1' : 'fas fa-check me-1'"></i>
            {{editingEvent ? 'Guardar cambios' : 'Crear evento'}}
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade" [class.show]="showModal" [style.display]="showModal ? 'block' : 'none'"></div>

  <!-- Toast de notificación -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div *ngIf="showToast" class="toast show" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header" [ngClass]="toastType === 'success' ? 'bg-success text-white' : 'bg-danger text-white'">
        <strong class="me-auto">{{toastTitle}}</strong>
        <button type="button" class="btn-close btn-close-white" (click)="hideToast()"></button>
      </div>
      <div class="toast-body">
        {{toastMessage}}
      </div>
    </div>
  </div>
</div>
</div>
<!-- Footer mejorado -->
  <app-footer></app-footer>
