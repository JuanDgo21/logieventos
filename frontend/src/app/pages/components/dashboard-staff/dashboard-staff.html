<app-navbar></app-navbar>

<div class="dashboard-layout">
  <app-sidebar></app-sidebar>

  <main class="dashboard-content">
    <!-- Header del Dashboard -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1><i class="fas fa-users-cog me-2"></i> Panel de Personal</h1>
        <div class="header-actions">
          <button class="btn btn-refresh" (click)="loadData()">
            <i class="fas fa-sync-alt"></i> Actualizar
          </button>
        </div>
      </div>
    </div>

    <div class="user-greeting">
      <h2>Â¡Hola {{authService.getCurrentUserData()?.role}}! <span class="greeting-emoji">ðŸ‘‹</span></h2>
      <p class="daily-message">GestiÃ³n de recursos humanos en tiempo real</p>
    </div>

    <!-- Loading indicator -->
    @if (isLoading) {
      <div class="loading-overlay">
        <div class="spinner-grow text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3">Cargando datos del personal...</p>
      </div>
    }

    @if (!isLoading) {
      <!-- Tarjetas de Resumen -->
      <div class="summary-cards">
        <div class="summary-card" [style.background]="getGradient('totalEmployees')">
          <div class="card-content">
            <div class="card-icon">
              <i class="fas fa-user-tie"></i>
            </div>
            <div class="card-info">
              <h3>{{ stats.totalEmployees }}</h3>
              <p>Total Empleados</p>
              <small>+{{ stats.newHires }} este mes</small>
            </div>
            <div class="card-wave"></div>
          </div>
        </div>

        <div class="summary-card" [style.background]="getGradient('activeEmployees')">
          <div class="card-content">
            <div class="card-icon">
              <i class="fas fa-user-check"></i>
            </div>
            <div class="card-info">
              <h3>{{ stats.activeEmployees }}</h3>
              <p>Activos</p>
              <small>{{ calculatePercentage(stats.activeEmployees) | number:'1.0-0' }}% del total</small>
            </div>
            <div class="card-wave"></div>
          </div>
        </div>

        <div class="summary-card" [style.background]="getGradient('onVacation')">
          <div class="card-content">
            <div class="card-icon">
              <i class="fas fa-umbrella-beach"></i>
            </div>
            <div class="card-info">
              <h3>{{ stats.onVacation }}</h3>
              <p>En Vacaciones</p>
              <small>{{ calculatePercentage(stats.onVacation) | number:'1.0-0' }}% del total</small>
            </div>
            <div class="card-wave"></div>
          </div>
        </div>

        <div class="summary-card" [style.background]="getGradient('newHires')">
          <div class="card-content">
            <div class="card-icon">
              <i class="fas fa-user-plus"></i>
            </div>
            <div class="card-info">
              <h3>{{ stats.newHires }}</h3>
              <p>Nuevos Contratos</p>
              <small>+{{ stats.newHires }} este mes</small>
            </div>
            <div class="card-wave"></div>
          </div>
        </div>
      </div>

      <!-- Contenido Principal -->
      <div class="dashboard-main">
        <!-- Acciones RÃ¡pidas -->
        <div class="dashboard-section quick-actions-section">
          <div class="section-header">
            <h2><i class="fas fa-bolt"></i> Acciones RÃ¡pidas</h2>
          </div>
          <div class="quick-actions-grid">
            @for (action of quickActions; track action.title) {
              <div class="quick-action" [style.background]="getGradient(action.title)" (click)="action.action()">
                <div class="action-content">
                  <i [class]="action.icon"></i>
                  <span>{{action.title}}</span>
                </div>
                <div class="action-wave"></div>
              </div>
            }
          </div>
        </div>

        <!-- Actividad Reciente -->
        <div class="dashboard-section recent-activity">
          <div class="section-header">
            <h2><i class="fas fa-history"></i> Ãšltimos Empleados</h2>
            <button class="btn btn-text" (click)="openAddPersonnelModal()">
              <i class="fas fa-plus me-1"></i> Agregar
            </button>
          </div>
          <div class="activity-list">
            @for (person of personnelList.slice(0, 5); track person) {
              <div class="activity-item">
                <div class="activity-icon" [style.background]="getGradient(person.status)">
                  <i class="fas fa-user"></i>
                </div>
                <div class="activity-details">
                  <p>{{ person.firstName }} {{ person.lastName }}</p>
                  <small>{{ getTypeName(person.personnelType) }} â€¢ 
                    <span [ngClass]="{
                      'text-success': person.status === 'disponible',
                      'text-primary': person.status === 'asignado',
                      'text-warning': person.status === 'vacaciones',
                      'text-secondary': person.status === 'inactivo'
                    }">
                      @switch (person.status) {
                        @case ('disponible') { Disponible }
                        @case ('asignado') { Asignado }
                        @case ('vacaciones') { Vacaciones }
                        @default { Inactivo }
                      }
                    </span>
                  </small>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <!-- DistribuciÃ³n por departamento -->
      <div class="dashboard-section department-section">
        <div class="section-header">
          <h2><i class="fas fa-building"></i> DistribuciÃ³n por Departamento</h2>
        </div>
        <div class="department-distribution">
          @for (dept of departmentDistribution.labels; track dept; let i = $index) {
            <div class="department-item">
              <div class="department-info">
                <div class="department-color" [style.background]="getColor(departmentDistribution.colors[i])"></div>
                <span>{{ dept }}</span>
              </div>
              <div class="department-stats">
                <span class="department-count">{{ departmentDistribution.data[i] }} ({{ calculatePercentage(departmentDistribution.data[i]) | number:'1.0-0' }}%)</span>
                <div class="progress-bar-container">
                  <div class="progress-bar" 
                      [style.width]="calculatePercentage(departmentDistribution.data[i]) + '%'"
                      [style.background]="getColor(departmentDistribution.colors[i])">
                  </div>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    }
  </main>
</div>

<app-footer></app-footer>