<div class="dashboard-container">
  <!-- Navbar en la parte superior -->
  <app-navbar></app-navbar>

  <div class="main-content-wrapper">
    <!-- Sidebar a la izquierda -->
    <app-sidebar class="sidebar"></app-sidebar>

    <!-- Contenido principal con la lista de usuarios -->
    <main class="content-area">

<div class="container-fluid p-4 user-management-container">
  <!-- Header y botón nuevo usuario -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">
      <i class="fas fa-users me-2"></i>Gestión de Usuarios
    </h2>
    <button class="btn btn-primary" (click)="openUserForm()">
      <i class="fas fa-plus me-2"></i>NUEVO USUARIO
    </button>
  </div>

  <!-- Barra de búsqueda -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-8 mb-3 mb-md-0">
          <div class="input-group">
            <span class="input-group-text bg-light">
              <i class="fas fa-search"></i>
            </span>
            <input type="text" class="form-control form-control-lg" 
                   placeholder="Buscar usuarios..." 
                   [(ngModel)]="searchTerm" 
                   (input)="applyFilters()">
          </div>
        </div>
        <div class="col-md-4">
          <button class="btn btn-outline-secondary w-100 h-100" (click)="resetFilters()">
            <i class="fas fa-undo me-2"></i>Limpiar filtros
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="row mb-4 g-3">
    <div class="col-md-6 col-lg-3">
      <div class="card h-100">
        <div class="card-body">
          <label class="form-label">Estado</label>
          <select class="form-select" [(ngModel)]="statusFilter" (change)="applyFilters()">
            <option value="all">Todos los estados</option>
            <option value="active">Activos</option>
            <option value="inactive">Inactivos</option>
          </select>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-3">
      <div class="card h-100">
        <div class="card-body">
          <label class="form-label">Rol</label>
          <select class="form-select" [(ngModel)]="roleFilter" (change)="applyFilters()">
            <option value="all">Todos los roles</option>
            <option value="admin">Administrador</option>
            <option value="coordinador">Coordinador</option>
            <option value="lider">Líder</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabla de usuarios -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>Documento</th>
              <th>Nombre Completo</th>
              <th>Email</th>
              <th>Rol</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <!-- Estado de carga -->
            <tr *ngIf="loading">
              <td colspan="6" class="text-center py-5">
                <div class="d-flex justify-content-center align-items-center">
                  <div class="spinner-border text-primary me-3" role="status"></div>
                  <span class="fs-5">Cargando usuarios...</span>
                </div>
              </td>
            </tr>

            <!-- Usuarios -->
            <tr *ngFor="let user of filteredUsers" class="user-row">
              <td>{{ user.document || 'N/A' }}</td>
              <td>{{ user.fullname }}</td>
              <td>{{ user.email }}</td>
              <td>
                <span class="badge rounded-pill py-2 px-3" [ngClass]="{
                  'bg-primary': user.role === 'admin',
                  'bg-success': user.role === 'coordinador',
                  'bg-info': user.role === 'lider'
                }">
                  {{ user.role | titlecase }}
                </span>
              </td>
              <td>
                <span class="badge rounded-pill py-2 px-3" [ngClass]="{
                  'bg-success': user.active,
                  'bg-secondary': !user.active
                }">
                  {{ user.active ? 'Activo' : 'Inactivo' }}
                </span>
              </td>
              <td>
                <div class="action-buttons d-flex gap-2">
                    <!-- Botón Editar -->
                    <button class="btn btn-sm btn-outline-primary action-btn" 
                            (click)="handleButtonClick('edit', user, $event)"
                            ngbTooltip="Editar" placement="top">
                    <i class="fas fa-edit"></i>
                    </button>
                    
                    <!-- Botón Eliminar -->
                    <button class="btn btn-sm btn-outline-danger action-btn" 
                            (click)="handleButtonClick('delete', user, $event)"
                            ngbTooltip="Eliminar" placement="top">
                    <i class="fas fa-trash-alt"></i>
                    </button>
                    
                    <!-- Botón Estado -->
                    <button class="btn btn-sm action-btn" 
                            [ngClass]="{
                            'btn-outline-success': !user.active,
                            'btn-outline-warning': user.active
                            }" 
                            (click)="handleButtonClick('toggle', user, $event)"
                            [ngbTooltip]="user.active ? 'Desactivar' : 'Activar'" 
                            placement="top">
                    <i class="fas" [ngClass]="{
                        'fa-toggle-on': user.active,
                        'fa-toggle-off': !user.active
                    }"></i>
                    </button>
                </div>
                </td>
            </tr>

            <!-- Sin resultados -->
            <tr *ngIf="!loading && filteredUsers.length === 0">
              <td colspan="6" class="text-center py-5 text-muted">
                <div class="d-flex justify-content-center align-items-center">
                  <i class="fas fa-exclamation-circle me-3 fs-4"></i>
                  <span class="fs-5">No se encontraron usuarios con los filtros aplicados</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
</main>
  </div>

  <!-- Footer en la parte inferior -->
  <app-footer class="footer"></app-footer>
</div>