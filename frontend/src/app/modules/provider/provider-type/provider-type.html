<app-sidebar></app-sidebar>


<div class="provider-type-container">
  <div class="content" [class.sidebar-collapsed]="!sidebarState.isOpen">
    <app-navbar></app-navbar>
    <h2>
      <i class="fas fa-tags"></i>
      Gestión de Tipos de Proveedores
    </h2>

    <!-- Mensajes -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <!-- Loader -->
    <div *ngIf="isLoading" class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i> Cargando...
    </div>

    <!-- Formulario -->
    <div class="provider-type-form">
      <h3>{{ editingProviderType ? 'Editar Tipo' : 'Nuevo Tipo de Proveedor' }}</h3>
      
      <form (ngSubmit)="editingProviderType ? updateProviderType() : createProviderType()" #providerTypeForm="ngForm">
        <div class="form-group">
          <label>Nombre:</label>
          <input type="text" 
                 [(ngModel)]="(editingProviderType || newProviderType).name"
                 name="name" 
                 required
                 [disabled]="isLoading"
                 minlength="3"
                 maxlength="50">
          <small *ngIf="(editingProviderType || newProviderType).name && !isValidProviderType(editingProviderType || newProviderType)" 
                 class="text-warning">
            El nombre debe tener entre 3 y 50 caracteres
          </small>
        </div>

        <div class="form-group">
          <label>Descripción:</label>
          <textarea [(ngModel)]="(editingProviderType || newProviderType).description"
                    name="description"
                    [disabled]="isLoading"
                    rows="3"></textarea>
        </div>

        <div class="form-group" *ngIf="editingProviderType">
          <label>Estado:</label>
          <div class="status-toggle">
            <span class="status-label">{{ editingProviderType.isActive ? 'Activo' : 'Inactivo' }}</span>
            <label class="switch">
              <input type="checkbox" 
                     [checked]="editingProviderType.isActive"
                     (change)="editingProviderType.isActive = !editingProviderType.isActive">
              <span class="slider round"></span>
            </label>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" 
                  [disabled]="isLoading || !isValidProviderType(editingProviderType || newProviderType)">
            {{ isLoading ? 'Guardando...' : (editingProviderType ? 'Actualizar' : 'Crear') }}
          </button>
          <button *ngIf="editingProviderType" 
                  type="button"
                  (click)="cancelEdit()" 
                  [disabled]="isLoading">
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Tabla -->
    <div class="provider-type-table">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let type of providerTypes">
            <td>{{ type.name }}</td>
            <td>{{ type.description || '--' }}</td>
            <td>
              <span class="status-badge" [class.active]="type.isActive">
                {{ type.isActive ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td class="actions">
              <button (click)="editProviderType(type)" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button (click)="toggleStatus(type)" 
                      [title]="type.isActive ? 'Desactivar' : 'Activar'"
                      class="status-toggle-btn">
                <i [class]="type.isActive ? 'fas fa-toggle-on' : 'fas fa-toggle-off'"></i>
              </button>
              <button (click)="deleteProviderType(type._id!)" title="Eliminar" class="danger">
                <i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
          <tr *ngIf="providerTypes.length === 0 && !isLoading">
            <td colspan="4" class="no-data">
              <i class="fas fa-box-open"></i>
              No hay tipos de proveedores registrados
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>